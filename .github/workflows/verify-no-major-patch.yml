name: Verify No Major Versions Released In Patches

on:
    pull_request:
        branches:
            - develop

jobs:
    verify:
        runs-on: ubuntu-latest

        steps:
            # Checkout the repository
            - name: Checkout code
              uses: actions/checkout@v3

            # Fetch the develop branch
            - name: Fetch develop branch
              run: git fetch origin develop:develop

            # Fetch the branch the PR is created from
            - name: Fetch PR branch
              run: git fetch origin ${{ github.head_ref }}:${{ github.head_ref }}

            # Checkout the branch the PR is created from
            - name: Checkout PR branch
              run: git checkout ${{ github.head_ref }}

            # Set up Node.js 20
            - name: Set up Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: 20

            # Install dependencies
            - name: Install dependencies
              run: npm install

            # Generate dependency graph
            - name: Generate Dependency Graph
              run: npm run generate-dependency-graph

            # Verify no major patches
            - name: Verify No Major Patches
              run: npm run verify-no-major-patches
