import{R as e,r as N}from"./index-DQDNmYQF.js";import{I}from"./Icon-D_nm5xPy.js";import{c as U}from"./index-D2FocPV0.js";import{S as q}from"./SecondaryButton-Boh02aDD.js";import{I as k}from"./InputGroup-CsZXON4u.js";import{I as R}from"./Input-D-am7U86.js";import{C as Q}from"./Checkbox--nJi1Rjz.js";function C({file:t,onFileDeleted:s,cancelText:i,deleteText:o}){const l="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgLTk2MCA5NjAgOTYwIiB3aWR0aD0iMjQiPjxwYXRoIGQ9Ik00ODAtNDM3Ljg0NyAyNzcuMDc2LTIzNC45MjRxLTguMzA3IDguMzA4LTIwLjg4NCA4LjUtMTIuNTc2LjE5My0yMS4yNjgtOC41LTguNjkzLTguNjkyLTguNjkzLTIxLjA3NnQ4LjY5My0yMS4wNzZMNDM3Ljg0Ny00ODAgMjM0LjkyNC02ODIuOTI0cS04LjMwOC04LjMwNy04LjUtMjAuODg0LS4xOTMtMTIuNTc2IDguNS0yMS4yNjggOC42OTItOC42OTMgMjEuMDc2LTguNjkzdDIxLjA3NiA4LjY5M0w0ODAtNTIyLjE1M2wyMDIuOTI0LTIwMi45MjNxOC4zMDctOC4zMDggMjAuODg0LTguNSAxMi41NzYtLjE5MyAyMS4yNjggOC41IDguNjkzIDguNjkyIDguNjkzIDIxLjA3NnQtOC42OTMgMjEuMDc2TDUyMi4xNTMtNDgwbDIwMi45MjMgMjAyLjkyNHE4LjMwOCA4LjMwNyA4LjUgMjAuODg0LjE5MyAxMi41NzYtOC41IDIxLjI2OC04LjY5MiA4LjY5My0yMS4wNzYgOC42OTN0LTIxLjA3Ni04LjY5M0w0ODAtNDM3Ljg0N1oiLz48L3N2Zz4=";return e.createElement("li",null,!t.document&&!t.error&&e.createElement("div",{className:"ffe-file-upload__file-item-stencil"},e.createElement("button",{type:"button",id:t.name,className:"ffe-file-upload__file-item-delete-button",onClick:s},e.createElement("span",{className:"ffe-file-upload__file-item-delete-button-text"},i),e.createElement(I,{fileUrl:l,size:"md",className:"ffe-file-upload__file-item-delete-icon"})),e.createElement("div",{className:"ffe-file-upload__file-item-stencil-info"},e.createElement("div",{className:"ffe-file-upload__file-item-stencil-info-background"}),e.createElement("div",{className:"ffe-file-upload__file-item-stencil-info-filename"},t.name))),t.document&&!t.error&&e.createElement("div",{className:"ffe-file-upload__file-item-loaded"},e.createElement("button",{type:"button",id:t.name,className:"ffe-file-upload__file-item-delete-button",onClick:s},e.createElement("span",{className:"ffe-file-upload__file-item-delete-button-text"},o),e.createElement(I,{fileUrl:l,size:"md",className:"ffe-file-upload__file-item-delete-icon"})),e.createElement("div",{className:"ffe-file-upload__file-item-filename"},t.name)),t.error&&e.createElement("div",{className:"ffe-file-upload__file-item-error",role:"alert"},e.createElement("div",{className:"ffe-file-upload__file-item-error-icon"},e.createElement(I,{fileUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgLTk2MCA5NjAgOTYwIiB3aWR0aD0iMjAiPjxwYXRoIGQ9Ik00ODAuMjExLTM4MC40MTNxLTE3LjM2MyAwLTI5LjUzNy0xMi4wMjRUNDM4LjUtNDIxLjkxM3YtMjY0cTAtMTcuNDUyIDExLjk2My0yOS40NzYgMTEuOTY0LTEyLjAyNCAyOS4zMjYtMTIuMDI0IDE3LjM2MyAwIDI5LjUzNyAxMi4wMjR0MTIuMTc0IDI5LjQ3NnYyNjRxMCAxNy40NTItMTEuOTYzIDI5LjQ3Ni0xMS45NjQgMTIuMDI0LTI5LjMyNiAxMi4wMjRabTAgMTQ3LjgyNnEtMTcuMzYzIDAtMjkuNTM3LTExLjk2My0xMi4xNzQtMTEuOTY0LTEyLjE3NC0yOS4zMjYgMC0xNy4zNjMgMTEuOTYzLTI5LjUzNyAxMS45NjQtMTIuMTc0IDI5LjMyNi0xMi4xNzQgMTcuMzYzIDAgMjkuNTM3IDExLjk2M1E1MjEuNS0yOTEuNjYgNTIxLjUtMjc0LjI5N3EwIDE3LjM2Mi0xMS45NjMgMjkuNTM2LTExLjk2NCAxMi4xNzQtMjkuMzI2IDEyLjE3NFoiLz48L3N2Zz4=",size:"sm"})),e.createElement("button",{type:"button",id:t.name,className:"ffe-file-upload__file-item-delete-button",onClick:s},e.createElement("span",{className:"ffe-file-upload__file-item-delete-button-text"},o),e.createElement(I,{fileUrl:l,size:"md",className:"ffe-file-upload__file-item-delete-icon"})),e.createElement("div",{className:"ffe-file-upload__file-item-error-info"},e.createElement("div",{className:"ffe-file-upload__file-item-error-filename"},t.name),e.createElement("div",{className:"ffe-file-upload__file-item-error-message"},t.error))))}C.__docgenInfo={description:"",methods:[],displayName:"FileItem",props:{file:{required:!0,tsType:{name:"signature",type:"object",raw:`{
    name: string;
    document?: Document;
    error?: string;
}`,signature:{properties:[{key:"name",value:{name:"string",required:!0}},{key:"document",value:{name:"Document",required:!1}},{key:"error",value:{name:"string",required:!1}}]}},description:"Shape of the file type, name is required, error and document.content is optional"},onFileDeleted:{required:!0,tsType:{name:"ReactMouseEventHandler",raw:"React.MouseEventHandler<HTMLButtonElement>",elements:[{name:"HTMLButtonElement"}]},description:"Called when the user clicks the delete button for a given file. Is called with the name of the file in question."},cancelText:{required:!1,tsType:{name:"string"},description:"Label for the cancel button"},deleteText:{required:!1,tsType:{name:"string"},description:"Label for the delete button"}}};function x({id:t,label:s,files:i,cancelText:o,deleteText:l,multiple:d,title:g,infoText:L,infoSubText:T,uploadTitle:y,uploadMicroText:E,uploadSubText:h,accept:A="*",onFilesDropped:n,onFileDeleted:r,onFilesSelected:m}){const[f,u]=N.useState(!1),c=N.useRef(null),p="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgLTk2MCA5NjAgOTYwIiB3aWR0aD0iMjQiPjxwYXRoIGQ9Ik00ODAtMzQzLjUzOXEtNy4yMzEgMC0xMy40NjEtMi4zMDgtNi4yMzEtMi4zMDctMTEuODQ2LTcuOTIzTDMzMC4zMDktNDc4LjE1M3EtOC45MjMtOC45MjMtOC44MDctMjAuODg0LjExNS0xMS45NjEgOC44MDctMjEuMjY5IDkuMzA4LTkuMzA3IDIxLjM4NC05LjYxNSAxMi4wNzctLjMwOCAyMS4zODUgOWw3Ni45MjMgNzYuOTIzdi0zMDYuMDAxcTAtMTIuNzY5IDguNjE1LTIxLjM4NCA4LjYxNS04LjYxNiAyMS4zODQtOC42MTZ0MjEuMzg0IDguNjE2cTguNjE1IDguNjE1IDguNjE1IDIxLjM4NHYzMDYuMDAxbDc2LjkyMy03Ni45MjNxOC45MjMtOC45MjMgMjEuMTkyLTguODA4IDEyLjI2OS4xMTYgMjEuNTc3IDkuNDIzIDguNjkyIDkuMzA4IDguOTk5IDIxLjA3Ny4zMDggMTEuNzY5LTguOTk5IDIxLjA3Nkw1MDUuMzA3LTM1My43N3EtNS42MTUgNS42MTYtMTEuODQ2IDcuOTIzLTYuMjMgMi4zMDgtMTMuNDYxIDIuMzA4Wk0yNTIuMzA5LTE4MC4wMDFxLTMwLjMwOCAwLTUxLjMwOC0yMXQtMjEtNTEuMzA4di03OC40NjFxMC0xMi43NjkgOC42MTYtMjEuMzg0IDguNjE1LTguNjE1IDIxLjM4NC04LjYxNXQyMS4zODQgOC42MTVRMjQwLTM0My41MzkgMjQwLTMzMC43N3Y3OC40NjFxMCA0LjYxNiAzLjg0NiA4LjQ2MyAzLjg0NyAzLjg0NiA4LjQ2MyAzLjg0Nmg0NTUuMzgycTQuNjE2IDAgOC40NjMtMy44NDYgMy44NDYtMy44NDcgMy44NDYtOC40NjN2LTc4LjQ2MXEwLTEyLjc2OSA4LjYxNS0yMS4zODR0MjEuMzg0LTguNjE1cTEyLjc2OSAwIDIxLjM4NCA4LjYxNSA4LjYxNiA4LjYxNSA4LjYxNiAyMS4zODR2NzguNDYxcTAgMzAuMzA4LTIxIDUxLjMwOHQtNTEuMzA4IDIxSDI1Mi4zMDlaIi8+PC9zdmc+",M=a=>{a.preventDefault(),u(!1),n(a.dataTransfer.files)},Y=a=>{r(i[a.currentTarget.id])},z=()=>{c.current&&(c.current.value="",c.current.click())},F=a=>{m(a.target.files)};return e.createElement("div",{className:"ffe-file-upload"},e.createElement("div",{className:"ffe-file-upload__title"},g),Object.keys(i).length>0?e.createElement("div",{className:"ffe-file-upload__file-items-section"},Object.keys(i).map(a=>e.createElement(C,{key:a,file:i[a],cancelText:o,deleteText:l,onFileDeleted:Y}))):e.createElement("div",{className:"ffe-file-upload__info-section"},e.createElement("div",{className:"ffe-file-upload__info-section-text"},L),e.createElement("div",{className:"ffe-file-upload__info-section-subtext"},T)),e.createElement("div",{className:"ffe-file-upload__upload-section",onDrop:M,onDragOver:a=>{a.preventDefault(),u(!0)},onDragLeave:()=>u(!1)},e.createElement("div",{className:U("ffe-file-upload__upload-section-border",{"ffe-file-upload__upload-section-border--hover":f})},e.createElement("div",{className:"ffe-file-upload__upload-section-title"},y),e.createElement("div",{className:"ffe-file-upload__upload-section-microtext"},E),e.createElement(q,{tabIndex:0,as:"label",htmlFor:t,leftIcon:e.createElement(I,{fileUrl:p,size:"md"}),onClick:a=>{a.preventDefault(),z()},onKeyUp:a=>{(a.key==="Enter"||a.key===" ")&&z()}},s),e.createElement("input",{id:t,type:"file",multiple:d,ref:c,onChange:F,accept:A}),e.createElement("div",{className:"ffe-file-upload__upload-section-subtext"},h))))}x.__docgenInfo={description:"",methods:[],displayName:"FileUpload",props:{id:{required:!0,tsType:{name:"string"},description:"ID for the input field. The ID is used as a base for the label ID as well."},label:{required:!0,tsType:{name:"string"},description:"Label for the button to trigger native upload handling."},files:{required:!0,tsType:{name:"Record",elements:[{name:"string"},{name:"FileItemProps['file']",raw:"FileItemProps<Document>['file']"}],raw:"Record<string, FileItemProps<Document>['file']>"},description:"A map of files, indexed by file name (check file-shape on FileItem.js propTypes), that the user has uploaded.\nMust be maintained outside of `FileUpload`. It is up to the implementation to deny or accept file types, sizes, etc,\nand it is important that duplicates are not allowed."},multiple:{required:!1,tsType:{name:"boolean"},description:"Whether or not uploading multiple files at once via the native file handler is allowed"},title:{required:!0,tsType:{name:"string"},description:"Title module"},infoText:{required:!0,tsType:{name:"string"},description:"Text on the info-section"},infoSubText:{required:!1,tsType:{name:"string"},description:"Subtext on the info-section"},cancelText:{required:!1,tsType:{name:"string"},description:"Label for the cancel button"},deleteText:{required:!1,tsType:{name:"string"},description:"Label for the delete button"},uploadTitle:{required:!0,tsType:{name:"string"},description:"Title on the upload-section"},uploadMicroText:{required:!0,tsType:{name:"string"},description:"MicroText on the upload-section"},uploadSubText:{required:!0,tsType:{name:"string"},description:"SubText on the upload-section"},accept:{required:!1,tsType:{name:"string"},description:`Unique file type specifier that describes a type of file that may be selected by the user, e.g. ".pdf"
 See MDN for documentation on
 [Unique file type specifiers](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#unique_file_type_specifiers)`,defaultValue:{value:"'*'",computed:!1}}}};const H=t=>new Promise((s,i)=>{const o=new window.FileReader;o.onload=l=>s(l.target?l.target.result:null),o.onerror=l=>i(l),o.readAsDataURL(t)}),P=(t,s)=>{const i=t.lastIndexOf("."),o=i!==-1?t.slice(0,i):t,l=i!==-1?t.slice(i):"";let d=t,g=1;for(;s[d];)d=`${o}-${g}${l}`,g++;return d},W={title:"Komponenter/File-upload/FileUpload",component:x},j={args:{label:"Velg filer",title:"Dokumentasjon",infoText:"Det kan være vanskelig å estimere fremtiden, derfor kan du laste opp eventuelle filer som viser til fremtidig budsjett eller inntjening.",infoSubText:"Husk å ikke laste opp personsensitive opplysninger eller dokumenter som bedriften ikke vil dele.",uploadTitle:"Dra filene hit",uploadMicroText:"Eller",uploadSubText:"PDF-filer, maks 50 MB",files:{},cancelText:"Avbryt",deleteText:"Slett",multiple:!0},render:t=>e.createElement(x,{...t})},D={args:{...j.args},render:t=>{const[s,i]=N.useState(1),[o,l]=N.useState(!1),d=(n,r)=>new Promise((m,f)=>{console.log("POST",n,r),setTimeout(o?f:m,s*1e3)}),g=(n,r)=>console.log("DELETE",n,r),[L,T]=N.useState({}),y=n=>T(r=>({...r,[n.name]:n})),E=n=>{const r=Array.from(n||[]),m=L,f={};r.forEach(u=>{f[u.name]=P(u.name,{...m,...f})}),T(u=>r.reduce((c,p)=>{const M=f[p.name];return{...c,[M]:{name:M}}},u||{}));for(const u of r){const c=f[u.name];H(u).then(p=>{const M={name:c,document:{content:p}};return d("/upload",M).then(()=>M)}).then(p=>{y(p)}).catch(()=>{y({name:c,error:"It did not work"})})}},h=n=>{g("/delete",n),T(r=>{const{...m}=r;return delete m[n.name],m})},A=N.useId();return e.createElement(e.Fragment,null,e.createElement(k,null,e.createElement(x,{...t,id:A,files:L,onFilesSelected:n=>E(n),onFilesDropped:n=>{n&&E(n)},onFileDeleted:n=>h(n)})),e.createElement(k,{label:"Opplastningstid (sekunder)"},e.createElement(R,{name:"uploadDuration",value:s,type:"number",min:0,step:1,onChange:n=>i(Number(n.target.value)||0)})),e.createElement(k,null,e.createElement(Q,{name:"uploadShouldFail",checked:o,onChange:n=>l(n.target.checked)},"Opplastning skal feile")))}};var S,v,O;j.parameters={...j.parameters,docs:{...(S=j.parameters)==null?void 0:S.docs,source:{originalSource:`{
  args: {
    label: 'Velg filer',
    title: 'Dokumentasjon',
    infoText: 'Det kan være vanskelig å estimere fremtiden, derfor kan du laste opp eventuelle filer som viser til fremtidig budsjett eller inntjening.',
    infoSubText: 'Husk å ikke laste opp personsensitive opplysninger eller dokumenter som bedriften ikke vil dele.',
    uploadTitle: 'Dra filene hit',
    uploadMicroText: 'Eller',
    uploadSubText: 'PDF-filer, maks 50 MB',
    files: {},
    cancelText: 'Avbryt',
    deleteText: 'Slett',
    multiple: true
  },
  render: args => <FileUpload {...args} />
}`,...(O=(v=j.parameters)==null?void 0:v.docs)==null?void 0:O.source}}};var b,w,_;D.parameters={...D.parameters,docs:{...(b=D.parameters)==null?void 0:b.docs,source:{originalSource:`{
  args: {
    ...Standard.args
  },
  render: args => {
    /**
     * Fake API til et hypotetisk backend.
     *
     * Responstid og -status kan endres slik at man kan undersøke hvordan
     * FileUpload oppfører seg.
     */
    const [uploadDuration, setUploadDuration] = useState(1);
    const [uploadShouldFail, setUploadShouldFail] = useState(false);
    const sendPostRequest = (url: string, file: any) => new Promise((resolve, reject) => {
      console.log('POST', url, file);
      setTimeout(uploadShouldFail ? reject : resolve, uploadDuration * 1000);
    });
    const sendDeleteRequest = (url: string, file: any) => console.log('DELETE', url, file);

    /**
     * State og event handler som knytter sammen API og FileUpload.
     */
    const [attachments, setAttachments] = useState<Record<string, {
      name: string;
      document?: unknown;
      error?: string | undefined;
    }>>({});
    const updateAttachment = (file: {
      name: string;
      document?: unknown;
      error?: string | undefined;
    }) => setAttachments(prevState => ({
      ...prevState,
      [file.name]: file
    }));
    const uploadAttachments = (fileList: FileList | null) => {
      const files = Array.from(fileList || []) as File[];

      // Build a map of unique filenames for this batch
      const prevState = attachments;
      const uniqueNames: Record<string, string> = {};
      files.forEach(file => {
        uniqueNames[file.name] = getUniqueFileName(file.name, {
          ...prevState,
          ...uniqueNames
        });
      });

      // Add files to attachments with unique names
      setAttachments(prevState => files.reduce<{
        [key: string]: {
          name: string;
          document?: unknown;
          error?: string;
        };
      }>((acc, file) => {
        const newName = uniqueNames[file.name];
        return {
          ...acc,
          [newName]: {
            name: newName
          }
        };
      }, prevState || {}));

      // Read file content and upload to backend using unique name
      for (const file of files) {
        const newName = uniqueNames[file.name];
        getFileContent(file).then(content => {
          const attachment = {
            name: newName,
            document: {
              content
            }
          };
          return sendPostRequest('/upload', attachment).then(() => attachment);
        }).then(attachment => {
          updateAttachment(attachment);
        }).catch(() => {
          const attachment = {
            name: newName,
            error: 'It did not work'
          };
          updateAttachment(attachment);
        });
      }
    };
    const deleteAttachment = (file: {
      name: string;
      document?: unknown;
      error?: string | undefined;
    }) => {
      sendDeleteRequest('/delete', file);
      setAttachments(prevState => {
        const {
          ...nextState
        } = prevState;
        delete nextState[file.name];
        return nextState;
      });
    };
    const id = useId();
    return <>
                <InputGroup>
                    <FileUpload {...args} id={id} files={attachments} onFilesSelected={fileList => uploadAttachments(fileList)} onFilesDropped={files => {
          if (files) {
            uploadAttachments(files);
          }
        }} onFileDeleted={file => deleteAttachment(file)} />
                </InputGroup>
                <InputGroup label="Opplastningstid (sekunder)">
                    <Input name="uploadDuration" value={uploadDuration} type="number" min={0} step={1} onChange={evt => setUploadDuration(Number(evt.target.value) || 0)} />
                </InputGroup>
                <InputGroup>
                    <Checkbox name="uploadShouldFail" checked={uploadShouldFail} onChange={evt => setUploadShouldFail(evt.target.checked)}>
                        Opplastning skal feile
                    </Checkbox>
                </InputGroup>
            </>;
  }
}`,...(_=(w=D.parameters)==null?void 0:w.docs)==null?void 0:_.source}}};const G=["Standard","WithXHR"],ee=Object.freeze(Object.defineProperty({__proto__:null,Standard:j,WithXHR:D,__namedExportsOrder:G,default:W},Symbol.toStringTag,{value:"Module"}));export{ee as F,j as S};
